{% extends 'base.html' %}
{% load static %}

{% block page_title %}Checkout | InsiightPrep{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5 animate__animated animate__fadeIn">
        <h1 class="display-5 fw-bold mb-2">Secure <span class="text-primary-gradient">Checkout</span></h1>
        <p class="text-slate-500">Provide your details to receive your examination papers instantly.</p>
    </div>

    <div class="row g-4">
        <!-- Checkout Form -->
        <div class="col-lg-7 animate__animated animate__fadeInLeft">
            <div class="modern-card p-4 p-md-5">
                <h5 class="fw-bold mb-4">Customer Information</h5>
                
                <form action="." method="post" class="needs-validation" novalidate>
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <label for="{{ form.email.id_for_label }}" class="form-label fw-semibold text-slate-700">Email Address</label>
                        {{ form.email }}
                        <div class="x-small text-slate-400 mt-2">We'll send your receipt and download links here.</div>
                    </div>

                    <div class="mb-4">
                        <label for="{{ form.phone_number.id_for_label }}" class="form-label fw-semibold text-slate-700">Mobile Money Number</label>
                        {{ form.phone_number }}
                        <div class="x-small text-slate-400 mt-2">Crucial: Your paper passwords will be sent here via SMS.</div>
                    </div>

                    <div class="p-4 rounded-4 bg-slate-50 border border-dashed mb-4">
                        <div class="d-flex align-items-center gap-3">
                            <div class="p-2 rounded-circle bg-white text-primary shadow-sm">
                                <i class="fas fa-shield-halved"></i>
                            </div>
                            <div class="small text-slate-600">
                                Your payment is processed securely by <strong>Paystack</strong>. We do not store your sensitive payment data.
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary-gradient w-100 py-3 fw-bold shadow-lg mt-2">
                        Complete Purchase <i class="fas fa-lock ms-2"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="col-lg-5 animate__animated animate__fadeInRight">
            <div class="modern-card p-4 sticky-top" style="top: 100px;">
                <h5 class="fw-bold mb-4">Your Order</h5>
                
                <div class="order-items-list mb-4">
                    {% for item in cart %}
                        <div class="d-flex align-items-center gap-3 mb-3 pb-3 border-bottom border-slate-50">
                            <div class="p-2 rounded-3 bg-slate-50 border">
                                <i class="fas fa-file-pdf text-danger"></i>
                            </div>
                            <div class="flex-grow-1 overflow-hidden">
                                <div class="fw-bold small text-truncate">{{ item.paper.title }}</div>
                                <div class="x-small text-slate-400">{{ item.paper.subject.name }}</div>
                            </div>
                            <div class="fw-bold small">GHS {{ item.price }}</div>
                        </div>
                    {% endfor %}
                </div>

                <div class="d-flex justify-content-between mb-2">
                    <span class="text-slate-500 small">Subtotal</span>
                    <span class="text-slate-800 small">GHS {{ cart.get_total_price }}</span>
                </div>
                <div class="d-flex justify-content-between mb-4">
                    <span class="text-slate-500 small">Delivery</span>
                    <span class="text-success x-small fw-bold">INSTANT</span>
                </div>
                
                <hr class="border-slate-100 mb-4">
                
                <div class="d-flex justify-content-between align-items-center">
                    <span class="fw-bold fs-5">Total</span>
                    <span class="fw-bold fs-4 text-primary">GHS {{ cart.get_total_price }}</span>
                </div>

                <div class="mt-5 text-center">
                    <div class="d-flex justify-content-center gap-3 opacity-50 grayscale">
                        <i class="fab fa-cc-visa fa-2x"></i>
                        <i class="fab fa-cc-mastercard fa-2x"></i>
                        <img src="https://paystack.com/assets/img/login/paystack-logo.png" style="height: 20px; margin-top: 10px;" alt="Paystack">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .grayscale { filter: grayscale(1); }
</style>
{% endblock %}